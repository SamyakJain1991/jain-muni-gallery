<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery - Jain Muni</title>
<style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 20px;
background-color: #f4f4f4;
}
h1 {
text-align: center;
color: #333;
}
#adminAccess {
text-align: center;
margin-bottom: 20px;
}
#adminAccess input {
padding: 10px;
margin-right: 10px;
}
#adminAccess button {
padding: 10px 20px;
background-color: #007bff;
color: white;
border: none;
cursor: pointer;
}
#adminAccess button:hover {
background-color: #0056b3;
}
#uploadSection {
display: none;
text-align: center;
margin-bottom: 20px;
}
#uploadSection input[type="file"] {
margin: 10px;
}
#uploadSection button {
padding: 10px 20px;
background-color: #28a745;
color: white;
border: none;
cursor: pointer;
}
#uploadSection button:hover {
background-color: #218838;
}
#gallery {
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 20px;
}
.photo {
position: relative;
width: 200px;
text-align: center;
}
.photo img {
width: 100%;
height: auto;
border-radius: 5px;
}
.delete-btn {
position: absolute;
top: 5px;
right: 5px;
background-color: #dc3545;
color: white;
border: none;
padding: 5px 10px;
cursor: pointer;
border-radius: 3px;
}
.delete-btn:hover {
background-color: #c82333;
}
</style>
</head>
<body>
<h1>Gallery</h1>

<div id="adminAccess">
<input type="password" id="passwordInput" placeholder="Enter admin password">
<button onclick="checkPassword()">Admin Access</button>
</div>

<div id="uploadSection">
<form id="uploadForm" enctype="multipart/form-data">
<input type="file" id="photoInput" accept="image/*">
<button type="button" onclick="uploadPhoto()">Upload Photo</button>
</form>
</div>

<div id="gallery"></div>

<script>
function checkPassword() {
const password = document.getElementById('passwordInput').value;
if (password === 'admin123') {
document.getElementById('adminAccess').style.display = 'none';
document.getElementById('uploadSection').style.display = 'block';
loadGallery();
} else {
alert('Incorrect password!');
}
}

async function uploadPhoto() {
const fileInput = document.getElementById('photoInput');
const file = fileInput.files[0];
if (!file) {
alert('Please select a photo to upload!');
return;
}

const formData = new FormData();
formData.append('photo', file);

// Debug log to check form data before sending
console.log('Form data being sent:', formData.get('photo'));

try {
const response = await fetch('/.netlify/functions/upload-photo', {
method: 'POST',
body: formData
});
const result = await response.json();

if (result.url && result.filePath) {
const gallery = document.getElementById('gallery');
const photoDiv = document.createElement('div');
photoDiv.className = 'photo';
photoDiv.innerHTML = `
<img src="${result.url}" alt="Uploaded Photo">
<button class="delete-btn" onclick="deletePhoto('${result.filePath}')">Delete</button>
`;
gallery.appendChild(photoDiv);
alert('Photo uploaded successfully!');
fileInput.value = ''; // Clear the input
} else {
alert('Upload failed!');
}
} catch (error) {
console.error('Error uploading photo:', error);
alert('Error uploading photo!');
}
}

async function deletePhoto(filePath) {
if (!confirm('Are you sure you want to delete this photo?')) return;

try {
const response = await fetch('/.netlify/functions/delete-photo', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({ filePath })
});
const result = await response.json();

if (result.success) {
const gallery = document.getElementById('gallery');
const photoDivs = gallery.getElementsByClassName('photo');
for (let div of photoDivs) {
if (div.querySelector('button').getAttribute('onclick').includes(filePath)) {
gallery.removeChild(div);
break;
}
}
alert('Photo deleted successfully!');
} else {
alert('Failed to delete photo!');
}
} catch (error) {
console.error('Error deleting photo:', error);
alert('Error deleting photo!');
}
}

async function loadGallery() {
// Optional: Load existing photos from Supabase if needed
// For now, gallery will populate as photos are uploaded
}
</script>
</body>
</html>
